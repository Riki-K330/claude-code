# CTFオンラインクリニック AIチャットボット

## 📋 概要
CTFオンラインクリニックの問い合わせ対応を自動化するAIチャットボットシステムです。Google Apps Script (GAS)、Google スプレッドシート、Anthropic Claude APIを使用して、非エンジニアでも簡単に構築・運用できます。

## 🚀 主な機能
- 💊 薬剤情報の自動応答（アカルボース、リベルサス、マンジャロ等）
- 💰 料金プラン案内
- 📝 手続きサポート（解約、変更、支払い方法）
- 📊 利用状況の分析とレポート
- 💸 APIコスト管理

## 📁 ファイル構成
```
rk0008_olc/
├── Config.gs          # 設定管理
├── Main.gs            # メイン処理
├── ClaudeAPI.gs       # Claude API連携
├── PromptManager.gs   # プロンプト管理
├── DataManager.gs     # データ管理
├── UI.gs              # ユーザーインターフェース
├── Sidebar.html       # チャット画面
└── README.md          # このファイル
```

## 🛠️ セットアップ手順

### 1. 事前準備
- Googleアカウント
- [Anthropic Claude API key](https://console.anthropic.com/)
- Google Chrome（推奨）

### 2. スプレッドシート作成
1. [Google ドライブ](https://drive.google.com)を開く
2. 新規 → Google スプレッドシート
3. 名前を「CTFクリニックAIチャットボット」に変更

### 3. Google Apps Script設定
1. スプレッドシートのメニュー → 拡張機能 → Apps Script
2. プロジェクト名を「CTFクリニックAIチャットボット」に変更
3. 各ファイル（.gs）を作成し、コードをコピー＆ペースト

### 4. 設定値の更新
`Config.gs`ファイルを開いて以下を設定：
```javascript
const CONFIG = {
  API_KEY: "your-actual-api-key-here", // ← Claude APIキー
  SHEET_ID: "your-spreadsheet-id",     // ← スプレッドシートID
  // ...
};
```

### 5. 初期化実行
1. スプレッドシートを再読み込み
2. メニューに「🤖 CTFチャットボット」が表示される
3. 「🔧 初期設定」をクリック

## 💬 使い方

### チャット機能
1. メニュー → 「💬 チャット画面を開く」
2. サイドバーに質問を入力
3. AIが自動で応答

### 管理機能
- **📊 使用状況レポート**: 月間の利用統計を確認
- **⚙️ 設定**: システム設定の変更
- **🧪 テスト実行**: 動作確認

## 📊 データ管理

### スプレッドシートのシート構成
| シート名 | 説明 | 編集可否 |
|---------|------|----------|
| 薬剤情報 | 取扱薬剤の詳細 | ✅ 可 |
| 料金プラン | プランと価格 | ✅ 可 |
| Q&A | よくある質問 | ✅ 可 |
| 対話履歴 | チャットログ | ❌ 自動 |
| API使用量 | コスト管理 | ❌ 自動 |
| 設定 | システム設定 | ⚠️ 注意 |

### データ更新方法
1. 該当シートを開く
2. 情報を編集
3. 変更は即座に反映

## 🔧 カスタマイズ

### プロンプトの調整
`PromptManager.gs`の`getSystemPrompt()`関数を編集：
```javascript
function getSystemPrompt() {
  return `あなたは「CTFオンラインクリニック事務局」の担当者として...`;
}
```

### 応答スタイルの変更
- 絵文字の追加/削除
- 挨拶文の変更
- トーンの調整

## 📈 運用管理

### 日次タスク
- [ ] エラーログ確認（対話履歴シート）
- [ ] API使用量チェック
- [ ] 未回答質問の確認

### 週次タスク
- [ ] Q&Aデータベース更新
- [ ] よくある質問の分析
- [ ] プロンプト調整

### 月次タスク
- [ ] 使用状況レポート確認
- [ ] コスト分析
- [ ] システム最適化

## ⚠️ 注意事項

### セキュリティ
- APIキーは絶対に共有しない
- スプレッドシートの共有設定に注意
- 個人情報は自動的にマスキング

### 医療情報の取り扱い
- 診断行為は行わない
- 効果・副作用は一般的な情報のみ
- 必ず医師への相談を促す

### コスト管理
- 月間予算: 50,000円（デフォルト）
- 予算超過時は自動アラート
- API使用量シートで詳細確認

## 🆘 トラブルシューティング

### よくあるエラー
1. **「APIキーが設定されていません」**
   - Config.gsのAPI_KEYを確認

2. **「スプレッドシートIDが設定されていません」**
   - URLから`/d/[ここがID]/edit`を取得

3. **応答が遅い**
   - API使用量を確認
   - ネットワーク環境を確認

### サポート
技術的な問題は以下を確認：
1. エラーログ（対話履歴シート）
2. Google Apps Scriptのログ（表示 → ログ）
3. システム管理者に連絡

## 📝 更新履歴
- 2024/06/03: 初版作成
- 継続的な改善を実施中

---

*このシステムは医療機関向けのサポートツールです。適切な医療情報の取り扱いにご注意ください。*