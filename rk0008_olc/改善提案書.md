# CTFã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¯ãƒªãƒ‹ãƒƒã‚¯ ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆæ”¹å–„ææ¡ˆæ›¸

## ğŸ¯ ç¾çŠ¶åˆ†æã¨æ”¹å–„æ©Ÿä¼š

### ç¾åœ¨ã®å¼·ã¿
1. **éã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å‘ã‘è¨­è¨ˆ** - GASã¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã§é‹ç”¨å¯èƒ½
2. **åŒ…æ‹¬çš„ãªçŸ¥è­˜ãƒ™ãƒ¼ã‚¹** - è–¬å‰¤æƒ…å ±ã€æ–™é‡‘ã€æ‰‹ç¶šãã‚’ç¶²ç¾…
3. **è¦ªã—ã¿ã‚„ã™ã„å¯¾å¿œ** - LINEæƒ³å®šã®çµµæ–‡å­—ä»˜ãå¿œç­”

### æ”¹å–„ãŒå¿…è¦ãªé ˜åŸŸ
1. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£** - å¤§é‡ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®å¯¾å¿œ
2. **å¤šè¨€èªå¯¾å¿œ** - å¤–å›½äººæ‚£è€…ã¸ã®å¯¾å¿œ
3. **é«˜åº¦ãªæ–‡è„ˆç†è§£** - è¤‡é›‘ãªè³ªå•ã¸ã®å¯¾å¿œåŠ›

## ğŸ’¡ çŸ­æœŸçš„æ”¹å–„ææ¡ˆï¼ˆ1-2ãƒ¶æœˆï¼‰

### 1. ãƒ¬ã‚¹ãƒãƒ³ã‚¹å“è³ªå‘ä¸Š
```javascript
// SmartResponseCache.gs - ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ 
class SmartResponseCache {
  constructor() {
    this.cache = CacheService.getScriptCache();
    this.ttl = 3600; // 1æ™‚é–“
  }
  
  getOrGenerate(query, generator) {
    const key = this.generateKey(query);
    let cached = this.cache.get(key);
    
    if (cached) {
      return JSON.parse(cached);
    }
    
    const response = generator();
    this.cache.put(key, JSON.stringify(response), this.ttl);
    return response;
  }
  
  generateKey(query) {
    // é¡ä¼¼ã‚¯ã‚¨ãƒªã‚’åŒä¸€è¦–ã™ã‚‹ãŸã‚ã®æ­£è¦åŒ–
    return Utilities.base64Encode(
      query.toLowerCase()
        .replace(/[ã€‚ã€ï¼ï¼Ÿ\s]/g, '')
        .slice(0, 50)
    );
  }
}
```

### 2. ã‚¨ãƒ©ãƒ¼å›å¾©æ©Ÿèƒ½
```javascript
// ErrorRecovery.gs - ã‚¨ãƒ©ãƒ¼å›å¾©ã‚·ã‚¹ãƒ†ãƒ 
function enhancedProcessMessage(userMessage, userId) {
  const maxRetries = 3;
  let lastError = null;
  
  for (let i = 0; i < maxRetries; i++) {
    try {
      // é€šå¸¸å‡¦ç†
      return processUserMessage(userMessage, userId);
    } catch (error) {
      lastError = error;
      
      // ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥
      if (error.toString().includes('Rate limit')) {
        Utilities.sleep(Math.pow(2, i) * 1000); // æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•
      } else if (error.toString().includes('Timeout')) {
        // ç°¡æ˜“ç‰ˆå¿œç­”ã‚’è¿”ã™
        return getFallbackResponse(userMessage);
      }
    }
  }
  
  // å…¨ãƒªãƒˆãƒ©ã‚¤å¤±æ•—æ™‚
  return getEmergencyResponse(lastError);
}
```

### 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“å‘ä¸Š
```javascript
// EnhancedUI.gs - UIæ”¹å–„
function addTypingSpeed() {
  // æ–‡å­—æ•°ã«å¿œã˜ãŸè‡ªç„¶ãªã‚¿ã‚¤ãƒ”ãƒ³ã‚°é€Ÿåº¦
  const responseLength = response.length;
  const typingDelay = Math.min(responseLength * 20, 3000);
  
  return {
    response: response,
    typingDelay: typingDelay,
    suggestedActions: getSuggestedActions(intent)
  };
}

function getSuggestedActions(intent) {
  const actions = {
    'medicine_info': [
      'æ–™é‡‘ã‚’ç¢ºèªã™ã‚‹',
      'å‰¯ä½œç”¨ã«ã¤ã„ã¦',
      'ä»–ã®è–¬ã¨æ¯”è¼ƒ'
    ],
    'pricing': [
      'ãŠå¾—ãªãƒ—ãƒ©ãƒ³ã‚’è¦‹ã‚‹',
      'æ”¯æ‰•ã„æ–¹æ³•',
      'è§£ç´„ã«ã¤ã„ã¦'
    ]
  };
  
  return actions[intent] || [];
}
```

## ğŸš€ ä¸­æœŸçš„æ”¹å–„ææ¡ˆï¼ˆ3-6ãƒ¶æœˆï¼‰

### 1. LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé€£æº
```javascript
// LineIntegration.gs
function doPost(e) {
  const events = JSON.parse(e.postData.contents).events;
  
  events.forEach(event => {
    if (event.type === 'message' && event.message.type === 'text') {
      const userId = event.source.userId;
      const userMessage = event.message.text;
      
      // ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå‡¦ç†
      const response = processUserMessage(userMessage, userId);
      
      // LINEè¿”ä¿¡
      replyToLine(event.replyToken, response.response);
    }
  });
  
  return ContentService
    .createTextOutput(JSON.stringify({'status': 'ok'}))
    .setMimeType(ContentService.MimeType.JSON);
}
```

### 2. ç”»åƒèªè­˜æ©Ÿèƒ½
```javascript
// ImageRecognition.gs - å‡¦æ–¹ç®‹ãƒ»è–¬å‰¤ç”»åƒã®èªè­˜
function processImageMessage(imageUrl, userId) {
  // Claude Vision APIã‚’ä½¿ç”¨
  const imageData = UrlFetchApp.fetch(imageUrl).getBlob();
  
  const prompt = `ã“ã®ç”»åƒã«å†™ã£ã¦ã„ã‚‹è–¬å‰¤ã‚„å‡¦æ–¹ç®‹ã®å†…å®¹ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚
  CTFã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¯ãƒªãƒ‹ãƒƒã‚¯ã§å–ã‚Šæ‰±ã£ã¦ã„ã‚‹è–¬å‰¤ã¨ã®é–¢é€£æ€§ã‚‚å«ã‚ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚`;
  
  return callClaudeVisionAPI(imageData, prompt);
}
```

### 3. å¤šè¨€èªå¯¾å¿œ
```javascript
// Multilingual.gs
function detectAndTranslate(userMessage) {
  const languagePatterns = {
    'en': /^[a-zA-Z\s\.\,\!\?]+$/,
    'zh': /[\u4e00-\u9fa5]/,
    'ko': /[\uac00-\ud7af]/
  };
  
  let detectedLang = 'ja';
  for (const [lang, pattern] of Object.entries(languagePatterns)) {
    if (pattern.test(userMessage)) {
      detectedLang = lang;
      break;
    }
  }
  
  if (detectedLang !== 'ja') {
    // ç¿»è¨³å‡¦ç†
    const translatedQuery = translateToJapanese(userMessage, detectedLang);
    const response = processUserMessage(translatedQuery, userId);
    return translateFromJapanese(response, detectedLang);
  }
  
  return processUserMessage(userMessage, userId);
}
```

## ğŸ”® é•·æœŸçš„æ”¹å–„ææ¡ˆï¼ˆ6ãƒ¶æœˆä»¥ä¸Šï¼‰

### 1. äºˆæ¸¬çš„å¥åº·ç®¡ç†
```javascript
// PredictiveHealth.gs
class HealthTracker {
  analyzeUserPattern(userId) {
    const history = getUserMedicationHistory(userId);
    
    return {
      adherenceRate: calculateAdherence(history),
      riskFactors: identifyRiskFactors(history),
      recommendations: generatePersonalizedAdvice(history),
      nextCheckupReminder: calculateOptimalCheckupDate(history)
    };
  }
  
  sendProactiveReminders(userId) {
    const pattern = this.analyzeUserPattern(userId);
    
    if (pattern.adherenceRate < 0.8) {
      sendMessage(userId, `ãŠè–¬ã®æœç”¨ã€ãŠå¿˜ã‚Œã§ã¯ãªã„ã§ã™ã‹ï¼ŸğŸ˜Š
      è¦å‰‡æ­£ã—ã„æœç”¨ãŒåŠ¹æœçš„ã§ã™ğŸ’Š`);
    }
  }
}
```

### 2. AIã«ã‚ˆã‚‹å¥åº·ç›¸è«‡ã®é«˜åº¦åŒ–
```javascript
// AdvancedConsultation.gs
function enhancedHealthConsultation(query, userId) {
  const userProfile = getUserHealthProfile(userId);
  const medicalContext = getMedicalContext(query);
  
  const enhancedPrompt = `
  æ‚£è€…ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«:
  - æœç”¨è–¬: ${userProfile.medications}
  - æ—¢å¾€æ­´: ${userProfile.history}
  - ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼: ${userProfile.allergies}
  
  è³ªå•: ${query}
  
  åŒ»å­¦çš„ã«æ­£ç¢ºã§ã€å€‹åˆ¥åŒ–ã•ã‚ŒãŸå›ç­”ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚
  ãŸã ã—ã€è¨ºæ–­ã¯è¡Œã‚ãšã€å¿…è¦ã«å¿œã˜ã¦åŒ»å¸«ã¸ã®ç›¸è«‡ã‚’ä¿ƒã—ã¦ãã ã•ã„ã€‚
  `;
  
  return callClaudeAPI(enhancedPrompt, {
    medicalGuidelines: true,
    personalizedResponse: true
  });
}
```

### 3. ãƒ“ãƒ‡ã‚ªé€šè©±çµ±åˆ
```javascript
// VideoConsultation.gs
function scheduleVideoConsultation(userId, symptoms) {
  // ç—‡çŠ¶ã®ç·Šæ€¥åº¦ã‚’è©•ä¾¡
  const urgency = assessUrgency(symptoms);
  
  if (urgency === 'high') {
    // å³æ™‚ã‚ªãƒ³ãƒ©ã‚¤ãƒ³è¨ºå¯Ÿã‚’ææ¡ˆ
    return {
      action: 'immediate_consultation',
      message: 'ç—‡çŠ¶ã‚’ç¢ºèªã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚ã™ãã«ã‚ªãƒ³ãƒ©ã‚¤ãƒ³è¨ºå¯ŸãŒå¯èƒ½ã§ã™ğŸ‘¨â€âš•ï¸',
      availableSlots: getImmediateSlots()
    };
  } else {
    // é€šå¸¸ã®äºˆç´„
    return {
      action: 'schedule_consultation',
      message: 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³è¨ºå¯Ÿã®ã”äºˆç´„ã‚’æ‰¿ã‚Šã¾ã™ğŸ“…',
      availableSlots: getAvailableSlots()
    };
  }
}
```

## ğŸ“Š å®Ÿè£…å„ªå…ˆåº¦ãƒãƒˆãƒªãƒƒã‚¯ã‚¹

| æ©Ÿèƒ½ | å®Ÿè£…é›£æ˜“åº¦ | ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤ | å„ªå…ˆåº¦ |
|------|-----------|-------------|--------|
| ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ | ä½ | é«˜ | â­â­â­â­â­ |
| ã‚¨ãƒ©ãƒ¼å›å¾©æ©Ÿèƒ½ | ä½ | é«˜ | â­â­â­â­â­ |
| LINEé€£æº | ä¸­ | é«˜ | â­â­â­â­ |
| ç”»åƒèªè­˜ | é«˜ | ä¸­ | â­â­â­ |
| å¤šè¨€èªå¯¾å¿œ | ä¸­ | ä¸­ | â­â­â­ |
| äºˆæ¸¬çš„å¥åº·ç®¡ç† | é«˜ | é«˜ | â­â­ |

## ğŸ’° æŠ•è³‡å¯¾åŠ¹æœï¼ˆROIï¼‰äºˆæ¸¬

### çŸ­æœŸæ”¹å–„ï¼ˆ1-2ãƒ¶æœˆï¼‰
- **æŠ•è³‡**: 50ä¸‡å††ï¼ˆé–‹ç™ºå·¥æ•°ï¼‰
- **æœŸå¾…åŠ¹æœ**: 
  - å¿œç­”é€Ÿåº¦30%å‘ä¸Š
  - ã‚¨ãƒ©ãƒ¼ç‡50%å‰Šæ¸›
  - é¡§å®¢æº€è¶³åº¦10%å‘ä¸Š

### ä¸­æœŸæ”¹å–„ï¼ˆ3-6ãƒ¶æœˆï¼‰
- **æŠ•è³‡**: 200ä¸‡å††ï¼ˆé–‹ç™ºï¼‹ã‚¤ãƒ³ãƒ•ãƒ©ï¼‰
- **æœŸå¾…åŠ¹æœ**:
  - å•ã„åˆã‚ã›å¯¾å¿œè‡ªå‹•åŒ–ç‡80%
  - ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼å·¥æ•°60%å‰Šæ¸›
  - æ–°è¦é¡§å®¢ç²å¾—15%å¢—

### é•·æœŸæ”¹å–„ï¼ˆ6ãƒ¶æœˆä»¥ä¸Šï¼‰
- **æŠ•è³‡**: 500ä¸‡å††ï¼ˆé–‹ç™ºï¼‹é‹ç”¨ï¼‰
- **æœŸå¾…åŠ¹æœ**:
  - æ‚£è€…ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ200%å‘ä¸Š
  - è§£ç´„ç‡30%æ¸›å°‘
  - è¿½åŠ åç›Š20%å¢—

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **ç¬¬1é€±**: ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã‚¨ãƒ©ãƒ¼å›å¾©æ©Ÿèƒ½ã®å®Ÿè£…
2. **ç¬¬2-3é€±**: UIã®æ”¹å–„ã¨æœ€é©åŒ–
3. **ç¬¬4é€±**: ãƒ†ã‚¹ãƒˆã¨èª¿æ•´
4. **ç¬¬2æœˆ**: LINEé€£æºã®è¨­è¨ˆã¨å®Ÿè£…
5. **ç¬¬3æœˆä»¥é™**: é †æ¬¡é«˜åº¦ãªæ©Ÿèƒ½ã‚’è¿½åŠ 

## ğŸ“ å®Ÿè£…æ™‚ã®æ³¨æ„äº‹é …

1. **æ®µéšçš„ãƒªãƒªãƒ¼ã‚¹**: ä¸€åº¦ã«å…¨æ©Ÿèƒ½ã‚’å®Ÿè£…ã›ãšã€æ®µéšçš„ã«å±•é–‹
2. **A/Bãƒ†ã‚¹ãƒˆ**: æ–°æ©Ÿèƒ½ã¯ä¸€éƒ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ†ã‚¹ãƒˆå¾Œã«å…¨ä½“å±•é–‹
3. **ç›£è¦–å¼·åŒ–**: æ–°æ©Ÿèƒ½å°å…¥æ™‚ã¯ç›£è¦–ã‚’å¼·åŒ–ã—ã€å•é¡Œã‚’æ—©æœŸç™ºè¦‹
4. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°**: å„æ©Ÿèƒ½è¿½åŠ æ™‚ã«é‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚’æ›´æ–°
5. **ãƒãƒ¼ãƒ æ•™è‚²**: æ–°æ©Ÿèƒ½ã«ã¤ã„ã¦é‹ç”¨ãƒãƒ¼ãƒ ã¸ã®æ•™è‚²ã‚’å®Ÿæ–½

---

*ã“ã®ææ¡ˆæ›¸ã¯ç¶™ç¶šçš„ã«æ›´æ–°ã•ã‚Œã€ãƒ“ã‚¸ãƒã‚¹ãƒ‹ãƒ¼ã‚ºã¨æŠ€è¡“é€²åŒ–ã«å¿œã˜ã¦èª¿æ•´ã•ã‚Œã¾ã™ã€‚*