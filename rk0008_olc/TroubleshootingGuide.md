# CTFチャットボット トラブルシューティングガイド

## 現在の問題

ユーザーがアカルボースの価格を質問した際、AIが以下の誤った価格を回答している：
- 2,980円, 5,460円, 7,440円

正しい価格（スプレッドシートの値）：
- 5,980円, 14,940円, 23,880円

## 診断ステップ

### 1. スプレッドシート接続確認
```javascript
testSpreadsheetConnection()
```

### 2. データ取得テスト
```javascript
testPriceDataRetrieval()
```

### 3. 完全フローテスト
```javascript
testCompleteDataFlow()
```

## 実装した修正

### 1. システムプロンプト強化
- 価格データに関する指示を強化
- 推測や概算の禁止を明記

### 2. プロンプト構築強化
- 料金プラン情報セクションに明確な注意書きを追加
- データの使用制限を明記

### 3. デバッグ機能追加
- データフロー全体をテストする機能
- 各ステップでの詳細ログ出力

## 次のステップ

1. `testPriceDataRetrieval()`でデータが正しく取得されるか確認
2. 正しいデータが取得されていれば、プロンプト構築を確認
3. Claude APIに送信されるプロンプトにデータが含まれているか確認
4. 必要に応じてさらにプロンプトを強化

## 疑われる原因

1. スプレッドシートのデータ取得エラー
2. プロンプト構築時のデータ欠損
3. Claude APIへの指示が不十分
4. コンテキスト情報の優先度が低い